<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width = device-width, initial-scale = 0.8"/>
  <meta charset="utf-8">
  <title>{{ name }}</title>
  
  <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">
  <!--link href="/stylesheets/bootstrap-responsive.min.css" rel="stylesheet"-->
  <link href="/stylesheets/style.css" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheets/animations.css">
  <link rel="stylesheet" href="/plugin/cue/sxsw/MyFontsWebfontsKit/MyFontsWebfontsKit.css">
  {{#styles}}
  <link rel="stylesheet" href="{{.}}">
  {{/styles}}
  <style>
    body {
      background: #2A333B url(/plugin/cue/sxsw/back.png);
      width: 1920px;
      height: 1080px;
      overflow: hidden;
      margin: 0 0 0 0;
      background-size: cover;
      background-repeat: no-repeat;
      font-family: BrandonPrinted-One;
    }
    h1 {
      text-align: center;
      font-size: 22pt;
      margin: 0;
    }
    .dimmer {
      background: transparent;
      top: 0;
      left: 0;
      width: 1920px;
      height: 1080px;
      z-index: 10000;
      position: absolute;
      background-size: cover;
      background-repeat: no-repeat;
    }
    div.twitter {
      position: absolute;
      top: 215px;
      right: 30px;
      width: 370px;
      z-index: 10500;
      background: white;
      height: 100%;
      padding: 5px;
    }
    .logo {
      background: url(/plugin/cue/sxsw/whirligig_logo.png);
      top: 43px;
      left: 38px;
      width: 430px;
      height: 189px;
      z-index: 10500;
      position: absolute;
      background-size: contain;
      background-repeat: no-repeat;
    }
    #hud {
      z-index: 50;
    }
    /*
    #hud {
      border-top: thin solid rgba(30,30,30,.20);
      padding-top: 20px;
      width: 100%;
      max-height: 200px;
      overflow: hidden;
      text-align: center;
      position: absolute;
      bottom: 20px;
      z-index: 50;
    }
    */
    header {
      position: absolute;
      z-index: 50;
      right: 50px;
    }
    .hud-view, .all-view {
      z-index: 50;
      position: absolute;
      top: 0px;
    }
    canvas {
      position: absolute;
      z-index: 50;
      width: 1343px;
      height: 866px;
      bottom: 0;
      left: 0;
    }

    /*
    #hud .row {
      width: 1200px;
      margin: auto;
    }
    */
    #hud img {
       max-width: 90px;
       max-height: 91px;
    }
    #timer {
      font-size: 92pt;
      position: absolute;
      top: 100px;
      right: 20px;
      color: white;

    }
    iframe.twitter-tweet {
      margin-top: 1px !important;
      margin-bottom: 1px !important;
      opacity: 0;
    }
    .instructions {
      color: white;
      position: absolute;
      right: 215px;
      top: 76px;
    }

  </style>
</head>

<body>
  
    
  <div class="logo">
  </div>
  <h1 class="instructions">Visit mtolympus.me/vote or text 512.872.4637</h1>
  <div id="timer">

  </div>
  <!--div id="glasspane">
  </div-->
  <canvas id="cue-canvas">
  </canvas>
  <div class="sxsw-view all-view">
    
  </div>
  <div id="sxsw" class="clearfix">
    <div class="row">
      <div class="span4">
        <div class="twitter">
          <h1>#playinggod</h1>
          <div id="tweets">

          </div>
        </div>
      </div>
      <div class="span8">
        <div class="voting">
          <h1>Other</h1>
        </div>
      </div>
    </div>
    </div>
  </div>
  <!--video loop id="backvid" autoplay>
     <source src="http://162.221.181.72:3000/plugin/cue/images/VE_Smoke_Bkgrnd.mov" type="video/mp4"/>
  </video-->
  <!--img src="/img/frame2.png" id="frame" /-->
  <div class="dimmer">
  </div>


  <script type="text/javascript" src="/socket.io/socket.io.js">
  </script>
  <script src="/javascripts/mustache.js">
  </script>
  <script src="/javascripts/jquery.js">
  </script>
  
  <script src="/javascripts/createjs-2014.12.12.min.js">
  </script>
  <script type="text/javascript" src="/javascripts/olympus.js">
  </script>
  {{#scripts}}
  <script type="text/javascript" src="{{.}}">
  </script>
  {{/scripts}}

  <script async src="//platform.twitter.com/widgets.js" charset="utf-8">
  </script>
  <script>
    /*
    createjs.Sound.registerSound("/plugin/cue/sounds/Oracle Voting Sequence (Modified Final).wav", "oracle-transition");
    createjs.Sound.registerSound("/plugin/cue/sounds/Whisper (1min length).wav", "whisper-transition");
    createjs.Sound.registerSound("/plugin/cue/sounds/Yes with out.wav", "yes");
    createjs.Sound.registerSound("/plugin/cue/sounds/No with out.wav", "no");
    */

    
    var canvas = document.getElementById("cue-canvas");
    canvas.width = $(canvas).width();
    canvas.height = $(canvas).height();
    var stage = new createjs.Stage("cue-canvas");
    stage.autoClear = true;
    var elements = [];
    createjs.Ticker.addEventListener("tick", handleTick);

    function handleTick(event) {
      for(i = 0; i < elements.length; i++) {
        elements[i].draw(stage);
      }
      stage.update();
    }
    
    window.olympusInstance = new Olympus(stage);
    
    var socket = io.connect();
    socket.on("/cue/leaderboard", function(cmd) {
      if($('section.leaderboard').length > 0) {
        $('section.leaderboard').detach();
        return;
      }
      $.get("/leaderboard", {}, function(responseText, textStatus) {
        $('.hud-view').html($(responseText));
      });
    });
    socket.on("/cue/dimmer", function(cmd) {
      var dimmer = $('.dimmer').css('background');
      if (dimmer.indexOf('sxsw') >= 0) {
        $('.dimmer').css('background', 'transparent');
      } else {
        $('.dimmer').css('background', 'url(/plugin/cue/sxsw/bg_austin.png)');
      }
    });


    socket.on("cue.tweet", function(cmd) {
      // append a tweet, have a limit for number of tweets and delete the last one before pushing a new one on

      try {


        var parent = $('#tweets');
        var tweets = parent.find('div.wrapper');
        if (tweets.length == 8) {
          $(tweets[7]).remove();
        }

        var wrapper = document.createElement("div");
        wrapper.height = '100px';
        parent.prepend(wrapper);
        twttr.widgets.createTweet(
                cmd.id_str,
                wrapper,
                {
                  align: 'left',
                  theme: 'light',
                  conversation:	'none'
                })
                .then(function (el) {
                  try {
                    el = jQuery(el);
                    //el.contents().find('p.Tweet-text').html(new Date());
                    el.contents().find('div.Tweet-brand,div.Tweet-metadata,ul.tweet-actions').css("display", "none");
                    el.contents().find('.embeddedtweet-tweet').css("padding", "10px");
                    // hack for an ugly issue with oversized boxes
                    el.css('height', (el.height() + 1) + "px");
                    el.fadeTo(1000, 1);

                  } catch(e) {
                    console.error(e);
                  }

                });

      } catch(e) {
        console.error(e);
      }
    });

    socket.on("timer", function(cmd) {
      $('#timer').html(cmd.timer);
      $('#timer').fadeIn(1, function() {
        $('#timer').fadeOut(800);
      });
    });

    socket.on("stateUpdate", function(cmd) {
      console.log(cmd);
    });

    
    
    {{#eventOverride}}
      
      socket.emit('/cue/manual', {
        event_id: '{{eventOverride}}',
        screen: 'hud'
      });
    {{/eventOverride}}
    
    
    
  </script>
</body>

</html>
